<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Barcode Scanner</title>
<style>
  html, body { margin:0; padding:0; height:100%; font-family:sans-serif; background:#333; text-align:center; color:#fff; }
  #scanner-container { position:relative; width:100%; height:70vh; background:#000; overflow:hidden; }
  .overlay {
    position:absolute; top:50%; left:50%;
    width:60%; height:25%;
    transform:translate(-50%,-50%);
    border:3px solid red;
    box-sizing:border-box;
    pointer-events:none;
  }
  #result {
    margin-top:10px;
    font-size:1.2em;
    font-weight:bold;
    color:#fff;
    padding:10px 20px;
    border-radius:6px;
    display:inline-block;
    background-color:rgba(0,0,0,0.7);
    transition:background-color 0.3s;
  }
  #history { margin-top:15px; max-height:200px; overflow-y:auto; list-style:none; padding:0; width:90%; max-width:400px; margin-left:auto; margin-right:auto; color:#fff; }
  #history li { background:#444; color:#0f0; margin-bottom:6px; padding:8px 12px; border-radius:6px; font-weight:bold; }
  button { margin:10px 5px; padding:10px 20px; border:none; border-radius:6px; cursor:pointer; font-weight:bold; background:#555; color:#fff; }
  button:hover { background:#777; }
</style>
</head>
<body>

<div id="scanner-container"></div>
<div class="overlay"></div>
<div id="result">Scanning...</div>
<ul id="history"></ul>
<div>
  <button id="start">Start Scanner</button>
  <button id="stop">Stop Scanner</button>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/quagga/0.12.1/quagga.min.js"></script>
<script>
const resultEl = document.getElementById('result');
const historyEl = document.getElementById('history');
const startBtn = document.getElementById('start');
const stopBtn = document.getElementById('stop');

let lastScanned = null;
let scannedHistory = [];
let cooldown = false; // prevent multiple detections

function flashResult() {
  resultEl.style.backgroundColor = '#0f0'; // green flash
  setTimeout(()=>{ resultEl.style.backgroundColor='rgba(0,0,0,0.7)'; }, 400);
}

function startScanner() {
  Quagga.init({
    inputStream:{
      type:"LiveStream",
      target: document.querySelector('#scanner-container'),
      constraints:{ facingMode:"environment" },
    },
    decoder:{ readers:["code_128_reader"] },
    locate:true
  }, function(err){
    if(err){ console.error(err); alert("Camera error"); return; }
    Quagga.start();
    resultEl.textContent = "Scanning...";
  });

  Quagga.onDetected(function(data){
    const code = data.codeResult.code;
    if(cooldown || code===lastScanned) return;
    lastScanned = code;
    cooldown=true;
    setTimeout(()=>{ cooldown=false; },1500); // 1.5s cooldown

    resultEl.textContent = `Scanned: ${code}`;
    flashResult();

    if(!scannedHistory.includes(code)){
      scannedHistory.push(code);
      const li=document.createElement('li');
      li.textContent=code;
      historyEl.prepend(li);
    }
  });
}

function stopScanner(){ Quagga.stop(); resultEl.textContent="Scanner stopped."; }

startBtn.addEventListener('click', startScanner);
stopBtn.addEventListener('click', stopScanner);
</script>

</body>
</html>
