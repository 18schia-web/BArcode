<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Barcode Scanner</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<style>
  body, html { margin:0; padding:0; height:100%; font-family:sans-serif; background:#222; color:#fff; display:flex; flex-direction:column; align-items:center; justify-content:flex-start; }
  h1 { display:none; } /* hide heading for mobile view */
  #scanner-wrapper { position:relative; width:90%; max-width:500px; aspect-ratio:4/3; margin-top:20px; }
  #scanner-container { width:100%; height:100%; background:#000; position:relative; overflow:hidden; border-radius:12px; }
  .overlay { position:absolute; top:50%; left:50%; width:70%; height:25%; transform:translate(-50%,-50%); border:3px solid red; box-sizing:border-box; pointer-events:none; }
  #result { margin-top:10px; font-size:1.2em; font-weight:bold; color:#0f0; text-align:center; }
  #history { margin-top:15px; max-height:200px; overflow-y:auto; list-style:none; padding:0; width:90%; max-width:500px; }
  #history li { background:#333; color:#0f0; margin-bottom:6px; padding:8px 12px; border-radius:6px; font-weight:bold; }
  button { margin:10px 5px; padding:10px 20px; border:none; border-radius:6px; cursor:pointer; font-weight:bold; background:#555; color:#fff; }
  button:hover { background:#777; }
</style>
</head>
<body>

<div id="scanner-wrapper">
  <div id="scanner-container"></div>
  <div class="overlay"></div>
</div>

<div id="result">Scanning...</div>
<ul id="history"></ul>
<div>
  <button id="start">Start</button>
  <button id="stop">Stop</button>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/quagga/0.12.1/quagga.min.js"></script>
<script>
const resultEl = document.getElementById('result');
const historyEl = document.getElementById('history');
const startBtn = document.getElementById('start');
const stopBtn = document.getElementById('stop');

let lastScanned = null;
let scannedHistory = [];
let cooldown = false;

function flashResult() {
  resultEl.style.color = '#0f0';
  setTimeout(()=>{ resultEl.style.color = '#0f0'; }, 300);
}

function startScanner() {
  Quagga.init({
    inputStream: {
      type: "LiveStream",
      target: document.querySelector('#scanner-container'),
      constraints: { facingMode:"environment" }
    },
    decoder: { readers:["code_128_reader"] },
    locate:true
  }, function(err){
    if(err){ console.error(err); alert("Camera error"); return; }
    Quagga.start();
    resultEl.textContent = "Scanning...";
  });

  Quagga.onDetected(function(data){
    const code = data.codeResult.code;
    if(cooldown || code===lastScanned) return;
    lastScanned = code;
    cooldown=true;
    setTimeout(()=>{ cooldown=false; },1500);

    resultEl.textContent = `Scanned: ${code}`;
    flashResult();

    if(!scannedHistory.includes(code)){
      scannedHistory.push(code);
      const li=document.createElement('li');
      li.textContent=code;
      historyEl.prepend(li);
    }
  });
}

function stopScanner(){ Quagga.stop(); resultEl.textContent="Scanner stopped."; }

startBtn.addEventListener('click', startScanner);
stopBtn.addEventListener('click', stopScanner);
</script>

</body>
</html>
