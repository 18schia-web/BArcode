<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Barcode Scanner</title>

<script src="https://unpkg.com/html5-qrcode"></script>

<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: #f2f2f2;
}

.wrapper {
  max-width: 420px;
  margin: auto;
  padding: 12px;
}

h1 {
  text-align: center;
  margin-bottom: 10px;
}

#reader {
  width: 100%;
  height: 260px;
  border-radius: 12px;
  overflow: hidden;
  background: black;
}

#result {
  margin-top: 12px;
  padding: 10px;
  text-align: center;
  font-weight: bold;
  border-radius: 8px;
}

.valid { background: #22c55e; color: white; }
.invalid { background: #ef4444; color: white; }

#history {
  margin-top: 12px;
}

.entry {
  padding: 6px 8px;
  border-radius: 6px;
  margin-bottom: 4px;
  font-size: 14px;
}

.green { background: #dcfce7; color: #166534; }
.red { background: #fee2e2; color: #991b1b; }

a {
  display: block;
  margin-top: 10px;
  text-align: center;
  text-decoration: none;
  font-weight: bold;
  color: #2563eb;
}
</style>
</head>

<body>
<div class="wrapper">
  <h1>Barcode Scanner</h1>

  <div id="reader"></div>

  <div id="result">Scan a barcode</div>

  <div id="history"></div>

  <a href="attendance.html">View Attendance</a>
</div>

<script>
// ===== MASTER ATTENDANCE LIST (HARDCODED) =====
const attendanceList = {
  "11 Browne": [
    "Idris Bee","My Anh Cao","Ashley Chan","Cheng Zhe Xin","Sean Chia","Mir Kim",
    "Dawon Kim","Angelina Lai","Lucan Lee","Lee Le Jing","Nahyun Lee","Lee Ming Yuen",
    "Lim Jun Tong","Win Ny Lim","Sarveshwaran M","Ana Naeem","Ng Kayven","Win Sheng Ong",
    "Navya Sahu","Saw Tian Ying","Caden Tan","Tan Yu Shaun","Megan Wah","Angeline Wai",
    "Daniel Yeoh"
  ],
  "11 Gardner": [
    "Noah Abdullah","Ameer","Chloe Bayly","Niklaus Chan","Cruz Chan","Sheun Chan",
    "Chang Jun Xuan","Chong Yukki","Emily Chow","Dissha Harjeet Singh","Aidan Kadir",
    "Gyutae Kim","Timothy Lau","Hyoseon Lee","Eloise Lim","Lim Zhi Xuan","Lin Yu Tong",
    "Hannan Hafidz","David Oh","Benjamin Wong","Jo Chen Yap","Yaw Xuan Xi","River Yeong",
    "Kylasufiah Ziad"
  ],
  "11 Hattie": [
    "Amelia Aaron","Zara Carissa","Asher Chan","Chan Sze Cen","Chin Vernice Zi Xin",
    "May Davies","Angela Fu","Sophia Gow","Ho Kai Er","Victoria Hu","Haresh J","Tabitha S",
    "Jiho Kang","Yumin Kim","Reyan K","Amanda Liao","Lim Yu Hang","Ilan Naif",
    "Ashavihn Nezan","Harvard Ng","Yaashvin P","Ethan Seto","Yasmin Tho","Beth Wong",
    "Jo Shin Yap"
  ],
  "11 Sullivan": [
    "Choe Xin Ying","Atticus Goh","Neil Goswami","Ethan Jeevaraj","Seojun Kim",
    "Kua Eu Xiang","Lai Weng Hui","Lee Zi Rou","Lee Ming Yu","Amy L","Lee Chen Huan",
    "Lee Xhuen Yi","Cae Lyn Leong","Kylie Loi","Soudai Manabe","Anderson Louis",
    "Sulaymaan Mungaye","Lucas Philip","Reet Sachdeva","Le Ann Sia","Teioh Wu Yang",
    "Summer Teoh","Maya Wee","Wong Zhe Xun","Alexis Wong"
  ],
  "11 Keller": [
    "Qaisara A","Abdul Rahman","Jessalyn Chai","Edison Chow","Charlotte Chua","Tushita Dixit",
    "Kayson Goh","Seoyul Kim","Lee Pi Qi","Lee Jing Hao","Sean Lee","Liu Jiayi","Mario Mak",
    "Ng Jiun Yuh","Ooi Zhi Loon","Eunseo Park","Yunseo Roh","Yuvraj Neil","Seng Wen Jie",
    "Ethaan Siraj","Daniyal Siraj","Tung YiFan","Yap Xin Yee"
  ],
  "11 Montessori": [
    "Arif N","Ayush Balaji","Tavish Bansal","Jared Du","Eng Ken Ji","Olyvia Foley","Rachelle Goh",
    "Jae Won Ha","Myesha Hossain","Jiyul Kim","Alysha Lee","Lim Zhan Yi","Douglas Lim","Lim Xi",
    "Lim Wen Xin","Loh Kye Rin","Gavin","Kaelynn See","Shrividya Shivram","Pragnya Srinivasan",
    "Varshnee T","Wong Shan Li","Gabriel Wong","Jihyun Yoon"
  ]
};

// Flatten
const validNames = new Set(Object.values(attendanceList).flat());

// Present list (local only)
const present = JSON.parse(localStorage.getItem("presentList")) || [];

// Anti-spam
let lastText = "";
let lastTime = 0;

const resultBox = document.getElementById("result");
const historyDiv = document.getElementById("history");

function addHistory(text, ok) {
  const div = document.createElement("div");
  div.textContent = text;
  div.className = "entry " + (ok ? "green" : "red");
  historyDiv.prepend(div);
}

const scanner = new Html5Qrcode("reader");

scanner.start(
  { facingMode: "environment" },
  { fps: 10, qrbox: { width: 260, height: 120 } },
  (text) => {
    const now = Date.now();
    if (text === lastText && now - lastTime < 2000) return;

    lastText = text;
    lastTime = now;

    const cleaned = text.trim();

    // Letters + spaces only
    if (!/^[A-Za-z ]+$/.test(cleaned)) {
      resultBox.textContent = "Invalid barcode";
      resultBox.className = "invalid";
      addHistory(cleaned, false);
      return;
    }

    if (validNames.has(cleaned)) {
      if (!present.includes(cleaned)) {
        present.push(cleaned);
        localStorage.setItem("presentList", JSON.stringify(present));
      }
      resultBox.textContent = `✔ ${cleaned}`;
      resultBox.className = "valid";
      addHistory(cleaned, true);
    } else {
      resultBox.textContent = `✖ ${cleaned}`;
      resultBox.className = "invalid";
      addHistory(cleaned, false);
    }
  }
);
</script>
</body>
</html>
